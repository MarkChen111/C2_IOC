# C2 IOC å¨èƒæƒ…æŠ¥æ”¶é›†ç³»ç»Ÿ

è¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„å¨èƒæƒ…æŠ¥æ”¶é›†å’Œåˆå¹¶ç³»ç»Ÿï¼Œä»Žå¤šä¸ªå…¬å¼€æ¥æºæ”¶é›†æ¶æ„IPã€C2æœåŠ¡å™¨ç­‰IOCæ•°æ®ã€‚

## æ•°æ®æº

ç³»ç»Ÿç›®å‰é›†æˆäº†16ä¸ªå…¬å¼€å¨èƒæƒ…æŠ¥æºï¼ŒæŒ‰è´¨é‡åˆ†ä¸ºä¸‰ä¸ªç­‰çº§ï¼š

### ðŸŒŸ ä¼˜è´¨æ•°æ®æºï¼ˆ8ä¸ªï¼‰

| æ•°æ®æº | URL | æ•°æ®ç±»åž‹ | é‡‡é›†æ–¹å¼ | æ›´æ–°é¢‘çŽ‡ | æ•°é‡/ç‰¹ç‚¹ |
|--------|-----|----------|----------|----------|-----------|
| **ThreatFox** | https://threatfox.abuse.ch/export/ | é¡µé¢è¡¨æ ¼æ•°æ® | çˆ¬è™« | æ¯å¤©æ›´æ–° | çº¦800ä¸ªC2 IP |
| **URLhaus** | https://urlhaus.abuse.ch/downloads/csv_online/ | é¡µé¢è¡¨æ ¼æ•°æ® | çˆ¬è™« | æ¯å¤©æ›´æ–° | ä¼ æ’­æ¶æ„è½¯ä»¶çš„URLï¼Œè¿‡åŽ»30å¤©æ•°æ®ï¼Œéœ€ä»ŽURLæå–IP |
| **AlienVault OTX** | https://otx.alienvault.com/ | APIè®¢é˜… | APIè¯·æ±‚ | å®žæ—¶æ›´æ–° | è®¢é˜…ä¼˜è´¨IOCï¼Œæ¯æ—¥çº¦1000ä¸ª |
| **TweetFeed** | https://tweetfeed.live/api.html | APIè®¢é˜… | APIè¯·æ±‚ | æ¯å¤©æ›´æ–° | ä»ŽTwitteræ”¶é›†çš„IOC |
| **IPsum** | https://github.com/stamparm/ipsum | IPåˆ—è¡¨ | çˆ¬è™« | æ¯å¤©æ›´æ–° | çº¦2ä¸‡ä¸ªï¼Œè‡³å°‘åœ¨3ä¸ªå…¬å¼€é»‘åå•ä¸­å‡ºçŽ° |
| **Montysecurity** | https://github.com/montysecurity/C2-Tracker | IPåˆ—è¡¨ | çˆ¬è™« | æ¯å¤©æ›´æ–° | çº¦2000ä¸ªï¼Œä»ŽShodanæœç´¢çš„C2 IPï¼Œå«23ç§C2æ¡†æž¶ã€62ç§æ¶æ„è½¯ä»¶ |
| **NamePipes** | https://github.com/mthcht/awesome-lists | IPåˆ—è¡¨ | çˆ¬è™« | æ¯å¤©æ›´æ–° | ä»ŽThreatFoxçˆ¬å–5å¹´C2æ•°æ®ï¼Œçº¦5ä¸‡æ¡ï¼Œè¿‘ä¸€ä¸ªæœˆçº¦7000æ¡ |
| ~~**Blocklist.de**~~ | https://www.blocklist.de/en/export.html | IPåˆ—è¡¨ | ç›´æŽ¥ä¸‹è½½ | æ¯å¤©æ›´æ–° | çº¦2ä¸‡ä¸ªï¼Œä¸ŽC2å…³è”å°ï¼Œ**å·²å¼ƒç”¨** |

### â­ ä¸€èˆ¬æ•°æ®æºï¼ˆ5ä¸ªï¼‰

| æ•°æ®æº | URL | æ•°æ®ç±»åž‹ | é‡‡é›†æ–¹å¼ | æ›´æ–°é¢‘çŽ‡ | æ•°é‡/ç‰¹ç‚¹ |
|--------|-----|----------|----------|----------|-----------|
| **FireHOL** | https://github.com/firehol/blocklist-ipsets | IPåˆ—è¡¨ | çˆ¬è™« | æ¯å¤©æ›´æ–° | çº¦3ä¸‡C2 IP |
| **C2IntelFeeds** | https://github.com/drb-ra/C2IntelFeeds | IPåˆ—è¡¨ | çˆ¬è™« | æ¯å¤©æ›´æ–° | è¿‘30å¤©C2 IPï¼Œçº¦3000ä¸ª |
| **EmergingThreats** | https://rules.emergingthreats.net/blockrules/ | IPåˆ—è¡¨ | çˆ¬è™« | æ¯å¤©æ›´æ–° | æ¯å¤©çº¦400ä¸ªå—æ„ŸæŸ“IP |
| **CINS Score** | https://cinsscore.com/list/ci-badguys.txt | IPåˆ—è¡¨ | çˆ¬è™« | æ¯å¤©æ›´æ–° | çº¦15000ä¸ª |
| **Binary Defense** | https://www.binarydefense.com/banlist.txt | IPåˆ—è¡¨ | çˆ¬è™« | æ¯å¤©æ›´æ–° | çº¦4000ä¸ª |

### ðŸ“‹ ä¸€èˆ¬æ•°æ®æºï¼ˆ3ä¸ªï¼‰

| æ•°æ®æº | URL | æ•°æ®ç±»åž‹ | é‡‡é›†æ–¹å¼ | æ›´æ–°é¢‘çŽ‡ | æ•°é‡/ç‰¹ç‚¹ |
|--------|-----|----------|----------|----------|-----------|
| **SNORT** | https://snort.org/downloads/ip-block-list | IPåˆ—è¡¨ | çˆ¬è™« | æœªçŸ¥ | çº¦1600ä¸ª |
| **CyberCure** | https://api.cybercure.ai/feed/get_ips | IPåˆ—è¡¨ | çˆ¬è™« | æœªçŸ¥ | çº¦5ä¸‡ä¸ª |
| **GreenSnow** | https://blocklist.greensnow.co/greensnow.txt | IPåˆ—è¡¨ | çˆ¬è™« | æœªçŸ¥ | çº¦7000ä¸ªï¼Œç›‘æŽ§æ‰«æ/æš´åŠ›ç ´è§£ï¼šFTPã€SSHã€SMTPç­‰ |
| **ThreatView.io** | https://threatview.io/Downloads/ | IPåˆ—è¡¨ | çˆ¬è™« | æœªçŸ¥ | æœ€è¿‘1ä¸ªæœˆçº¦150ä¸ªCobaltStrike C2 IP |

## ç›®å½•ç»“æž„

```
C2_IOC/
â”œâ”€â”€ controller.py           # ä¸»æŽ§åˆ¶è„šæœ¬ï¼ˆåˆå¹¶æ‰€æœ‰æ•°æ®ï¼‰
â”œâ”€â”€ Public_IOC/            # å„ä¸ªæ•°æ®æºç›®å½•
â”‚   â”œâ”€â”€ alienvault/
â”‚   â”‚   â”œâ”€â”€ code.py        # æ•°æ®é‡‡é›†è„šæœ¬
â”‚   â”‚   â””â”€â”€ data/          # é‡‡é›†çš„æ•°æ®
â”‚   â”œâ”€â”€ urlhaus/
â”‚   â”œâ”€â”€ tweetfeed/
â”‚   â”œâ”€â”€ ...ï¼ˆå…¶ä»–æ•°æ®æºï¼‰
â”‚   â””â”€â”€ combine/           # åˆå¹¶åŽçš„æ•°æ®
â””â”€â”€ README.md
```

## ä½¿ç”¨æ–¹æ³•

### ðŸš€ å¿«é€Ÿå¼€å§‹

```bash
# 1. å®‰è£…ä¾èµ–
pip3 install --break-system-packages requests pyyaml

# 2. é…ç½®APIå¯†é’¥ï¼ˆå¦‚æžœéœ€è¦ï¼‰
vim config.yaml

# 3. è¿è¡Œæ¯æ—¥è‡ªåŠ¨æ›´æ–°
python3 run_daily_update.py

# 4. æŸ¥çœ‹ç»“æžœ
head -20 Public_IOC/combine/recent_high_risk_ips.csv | column -t -s $'\t'
```

### 1. è‡ªåŠ¨æ›´æ–°ï¼ˆæŽ¨èï¼‰

ä½¿ç”¨ä¸»æŽ§è„šæœ¬è‡ªåŠ¨é‡‡é›†æ‰€æœ‰æ•°æ®æºå¹¶åˆå¹¶ï¼š

```bash
# è¿è¡Œæ¯æ—¥æ›´æ–°ï¼ˆä¼šä¾æ¬¡è¿è¡Œæ‰€æœ‰16ä¸ªæ•°æ®æºï¼Œç„¶åŽè‡ªåŠ¨åˆå¹¶ï¼‰
python3 run_daily_update.py

# æŸ¥çœ‹è¿è¡Œæ—¥å¿—
tail -f logs/ioc_collection.log
```

### 2. å•ç‹¬è¿è¡ŒæŸä¸ªæ•°æ®æº

è¿›å…¥å¯¹åº”ç›®å½•è¿è¡Œé‡‡é›†è„šæœ¬ï¼š

```bash
# ç¤ºä¾‹ï¼šé‡‡é›†URLhausæ•°æ®
cd Public_IOC/urlhaus
python3 code.py
```

### 3. æ‰‹åŠ¨åˆå¹¶æ•°æ®

è¿è¡Œåˆå¹¶è„šæœ¬ï¼š

```bash
cd Public_IOC/combine
python3 combine.py
```

### 4. é…ç½®ç®¡ç†

ç¼–è¾‘é¡¹ç›®æ ¹ç›®å½•çš„ `config.yaml`ï¼š

```yaml
# æŽ’é™¤ä¸éœ€è¦çš„æ•°æ®æº
exclude_list:
  - SNORT
  - ipsum

# AlienVaulté…ç½®
alienvault:
  api_key: "your_api_key_here"
  days: 7
  max_pages: 200

# æ•°æ®ä¿ç•™ç­–ç•¥
data_retention:
  source_data_days: 7   # æ•°æ®æºæ–‡ä»¶ä¿ç•™å¤©æ•°
  recent_months: 3      # recent.csvä¿ç•™æœˆæ•°
```

### 5. è®¾ç½®å®šæ—¶ä»»åŠ¡

æ¯å¤©è‡ªåŠ¨è¿è¡Œï¼š

```bash
# ä½¿ç”¨crontabï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹ï¼‰
(crontab -l 2>/dev/null; echo "0 2 * * * cd /path/to/C2_IOC && /usr/bin/python3 run_daily_update.py >> logs/daily_\$(date +\%Y\%m\%d).log 2>&1") | crontab -
```

## æ•°æ®æ ¼å¼

### ç»Ÿä¸€æ ¼å¼

æ‰€æœ‰åˆå¹¶åŽçš„æ•°æ®ä½¿ç”¨ä»¥ä¸‹ç»Ÿä¸€æ ¼å¼ï¼ˆä½¿ç”¨ `\t` åˆ†éš”ï¼‰ï¼š

| å­—æ®µ | è¯´æ˜Ž | ç¤ºä¾‹ |
|------|------|------|
| ip | IPåœ°å€ï¼ˆå°å†™ï¼‰ | 192.168.1.1 |
| port | ç«¯å£ï¼ˆå¦‚æžœæœ‰ï¼‰ | 8080 |
| tag | å¨èƒç±»åž‹æ ‡ç­¾ | AsyncRAT\|Cobalt Strike |
| ioc_source | IOCæ¥æºï¼ˆæ•°æ®æºåç§°ï¼‰ | NamePipes\|urlhaus |
| first_seen_utc | IOCé¦–æ¬¡å‘çŽ°æ—¶é—´ | 2025-12-10 |
| crawl_date | æ•°æ®çˆ¬å–æ—¶é—´ | 2025-12-10 |
| count | å‡ºçŽ°åœ¨ä¸åŒæ•°æ®æºçš„æ¬¡æ•° | 5 |

### æ—¶é—´æ ¼å¼

ç»Ÿä¸€ä½¿ç”¨ `YYYY-MM-DD` æ ¼å¼ï¼Œä¾‹å¦‚ï¼š`2025-12-10`

### å­—æ®µè¯´æ˜Ž

- **tag**: å¨èƒç±»åž‹æ ‡ç­¾ï¼Œå¦‚AsyncRATã€Cobalt Strikeç­‰ï¼ˆå¦‚æžœæ•°æ®æºæ²¡æœ‰æä¾›ï¼Œåˆ™ä¸ºç©ºï¼‰
- **ioc_source**: IOCçš„æ¥æºæ•°æ®æºåç§°ï¼ˆå¤šä¸ªç”¨|åˆ†éš”ï¼‰
- **first_seen_utc**: å¨èƒæƒ…æŠ¥æºè®°å½•çš„IOCé¦–æ¬¡å‘çŽ°æ—¶é—´
- **crawl_date**: æˆ‘ä»¬çˆ¬å–æ•°æ®çš„æ—¶é—´ï¼ˆå³å½“å¤©æ—¥æœŸï¼‰
- **count**: è¯¥IPåœ¨ä¸åŒæ•°æ®æºä¸­å‡ºçŽ°çš„æ¬¡æ•°ï¼Œæ•°å€¼è¶Šé«˜è¡¨ç¤ºå¯ä¿¡åº¦è¶Šé«˜

## è¾“å‡ºæ–‡ä»¶

åˆå¹¶åŽçš„æ•°æ®ä¿å­˜åœ¨ `Public_IOC/combine/` ç›®å½•ä¸‹ï¼š

| æ–‡ä»¶ | è¯´æ˜Ž | æ•°æ®èŒƒå›´ | ç”¨é€” |
|------|------|----------|------|
| `history.csv` | æ‰€æœ‰åŽ†å²æ•°æ® | å®Œæ•´è®°å½• | åŽ†å²åˆ†æžã€å›žæº¯è°ƒæŸ¥ |
| `recent.csv` | æœ€è¿‘çš„æ´»è·ƒå¨èƒ | æœ€è¿‘3ä¸ªæœˆ | æ—¥å¸¸å¨èƒç›‘æŽ§ |
| `recent_high_risk_ips.csv` | é«˜å±IPï¼ˆå¤šæºéªŒè¯ï¼‰ | æœ€è¿‘3ä¸ªæœˆï¼Œcountâ‰¥3 | ç›´æŽ¥åº”ç”¨äºŽå®‰å…¨é˜²æŠ¤ ðŸŽ¯ |

**æ•°æ®ä¿ç•™ç­–ç•¥**ï¼š
- **history.csv**: ä¿å­˜æ‰€æœ‰åŽ†å²æ•°æ®ï¼ˆå®Œæ•´è®°å½•ï¼‰
- **recent.csv**: åªä¿ç•™æœ€è¿‘3ä¸ªæœˆçš„æ•°æ®ï¼ˆ`first_seen_utc` å’Œ `crawl_date` éƒ½å¿…é¡»åœ¨3ä¸ªæœˆå†…ï¼‰
- **recent_high_risk_ips.csv**: åªä¿ç•™æœ€è¿‘3ä¸ªæœˆå†…ï¼Œä¸”å‡ºçŽ°åœ¨3ä¸ªæˆ–ä»¥ä¸Šæ•°æ®æºçš„é«˜å±IPï¼ˆcount â‰¥ 3ï¼‰
- **æ•°æ®æºç›®å½•**: å„æ•°æ®æºçš„ `data/` ç›®å½•åªä¿ç•™æœ€è¿‘7å¤©çš„æ–‡ä»¶
- **é…ç½®æ–‡ä»¶**: `config.yaml` ä¸­å¯è°ƒæ•´ä¿ç•™å¤©æ•°

**é«˜å±IPç»Ÿè®¡ï¼ˆrecent_high_risk_ips.csvï¼‰**ï¼š
- count = 3: ~8,185æ¡ (68%) - é«˜å±
- count = 4: ~3,099æ¡ (26%) - å¾ˆé«˜å±
- count = 5: ~682æ¡ (6%) - æžé«˜å±
- count = 6: ~27æ¡ (0.2%) - âš ï¸ è¶…é«˜å±ï¼ˆå‡ºçŽ°åœ¨6ä¸ªæ•°æ®æºï¼‰

## æ•°æ®æºå­—æ®µæ˜ å°„

ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†ä¸åŒæ•°æ®æºçš„å­—æ®µå·®å¼‚ï¼š

- ç»Ÿä¸€IPå­—æ®µä¸ºå°å†™
- ç»Ÿä¸€æ—¶é—´å­—æ®µä¸º `first_seen_utc`
- ç»Ÿä¸€åˆ†éš”ç¬¦ä¸º `\t`ï¼ˆåˆ¶è¡¨ç¬¦ï¼‰
- è‡ªåŠ¨æå–å’Œè½¬æ¢æ—¥æœŸæ ¼å¼

## æ³¨æ„äº‹é¡¹

1. **ä¾èµ–å®‰è£…**: éœ€è¦å®‰è£… `requests` å’Œ `pyyaml`
   ```bash
   pip3 install --break-system-packages requests pyyaml
   ```

2. **APIå¯†é’¥**: AlienVault OTXéœ€è¦APIå¯†é’¥ï¼Œè¯·åœ¨ `config.yaml` ä¸­é…ç½®

3. **è¯·æ±‚é¢‘çŽ‡**: éƒ¨åˆ†æ•°æ®æºå¯èƒ½æœ‰è¯·æ±‚é¢‘çŽ‡é™åˆ¶ï¼Œ`run_daily_update.py` å·²å†…ç½®1ç§’å»¶è¿Ÿ

4. **æ•°æ®æ›´æ–°**: å»ºè®®æ¯å¤©è¿è¡Œä¸€æ¬¡ï¼Œå¯ä½¿ç”¨crontabè®¾ç½®å®šæ—¶ä»»åŠ¡

5. **å­˜å‚¨ç©ºé—´**: 
   - history.csv: ~8MBï¼ˆæŒç»­å¢žé•¿ï¼‰
   - recent.csv: ~6MBï¼ˆå›ºå®šå¤§å°ï¼‰
   - recent_high_risk_ips.csv: ~775KBï¼ˆå›ºå®šå¤§å°ï¼‰
   - æ—¥å¿—æ–‡ä»¶ä¼šæŒç»­å¢žé•¿ï¼Œå»ºè®®å®šæœŸæ¸…ç†

6. **æ•°æ®è´¨é‡**: 
   - ä¼˜å…ˆä½¿ç”¨ `recent_high_risk_ips.csv`ï¼ˆå¤šæºéªŒè¯ï¼Œè¯¯æŠ¥çŽ‡ä½Žï¼‰
   - countè¶Šé«˜çš„IPå¯ä¿¡åº¦è¶Šé«˜
   - å»ºè®®é…åˆå…¶ä»–å®‰å…¨å·¥å…·ç»¼åˆåˆ¤æ–­

## ä½¿ç”¨ç¤ºä¾‹

### æŸ¥çœ‹é«˜å±IPæ•°æ®

```bash
# æŸ¥çœ‹é«˜å±IPï¼ˆå‰10æ¡ï¼‰
head -11 Public_IOC/combine/recent_high_risk_ips.csv | column -t -s $'\t'

# ç»Ÿè®¡ä¸åŒå¨èƒçº§åˆ«çš„IPæ•°é‡
cut -f7 Public_IOC/combine/recent_high_risk_ips.csv | grep -v "count" | sort | uniq -c

# æŸ¥æ‰¾æžé«˜å±IPï¼ˆcount >= 5ï¼‰
awk -F'\t' '$7 >= 5' Public_IOC/combine/recent_high_risk_ips.csv
```

### æŸ¥è¯¢ç‰¹å®šIP

```bash
# æŸ¥è¯¢æŸä¸ªIPæ˜¯å¦åœ¨é«˜å±åˆ—è¡¨ä¸­
grep "1.2.3.4" Public_IOC/combine/recent_high_risk_ips.csv

# æŸ¥è¯¢åŒ…å«ç‰¹å®šæ ‡ç­¾çš„IP
grep -i "cobalt" Public_IOC/combine/recent_high_risk_ips.csv
```

### å¯¼å‡ºä¸ºé˜²ç«å¢™è§„åˆ™

```bash
# æå–æ‰€æœ‰é«˜å±IPåœ°å€
cut -f1 Public_IOC/combine/recent_high_risk_ips.csv | grep -v "ip" > high_risk_ips.txt

# åº”ç”¨åˆ°iptables
while read ip; do 
    iptables -A INPUT -s $ip -j DROP
done < high_risk_ips.txt

# åº”ç”¨åˆ°firewalld
while read ip; do 
    firewall-cmd --add-rich-rule="rule family='ipv4' source address='$ip' reject"
done < high_risk_ips.txt
```

### å¨èƒåˆ†æž

```bash
# ç»Ÿè®¡å„å¨èƒç±»åž‹æ•°é‡
cut -f3 Public_IOC/combine/recent_high_risk_ips.csv | tr '|' '\n' | sort | uniq -c | sort -rn

# ç»Ÿè®¡å„æ•°æ®æºè´¡çŒ®
cut -f4 Public_IOC/combine/recent_high_risk_ips.csv | tr '|' '\n' | sort | uniq -c | sort -rn

# æŒ‰æ—¶é—´ç»Ÿè®¡ï¼ˆæœ€è¿‘å‘çŽ°çš„å¨èƒï¼‰
cut -f5 Public_IOC/combine/recent_high_risk_ips.csv | grep -v "first_seen" | sort | uniq -c
```

## è®¸å¯

æœ¬é¡¹ç›®æ”¶é›†çš„æ•°æ®æ¥è‡ªå…¬å¼€çš„å¨èƒæƒ…æŠ¥æºï¼Œè¯·éµå®ˆå„æ•°æ®æºçš„ä½¿ç”¨æ¡æ¬¾ã€‚

## æ›´æ–°æ—¥å¿—

### 2025-12-10

**v1.0 åˆå§‹ç‰ˆæœ¬**
- âœ… é›†æˆ16ä¸ªå…¬å¼€å¨èƒæƒ…æŠ¥æº
- âœ… ç»Ÿä¸€æ•°æ®æ ¼å¼ï¼ˆ\tåˆ†éš”ï¼Œå°å†™IPï¼Œæ ‡å‡†æ—¶é—´æ ¼å¼ï¼‰
- âœ… æ™ºèƒ½å­—æ®µæ˜ å°„å’Œæ•°æ®æ ‡å‡†åŒ–
- âœ… æ”¯æŒæ•°æ®æºæŽ’é™¤åŠŸèƒ½ï¼ˆconfig.yamlï¼‰
- âœ… IPå¤šæºéªŒè¯ç»Ÿè®¡ï¼ˆcountå­—æ®µï¼‰
- âœ… è‡ªåŠ¨æ•°æ®æ¸…ç†ï¼ˆä¿ç•™ç­–ç•¥å¯é…ç½®ï¼‰

**v1.1 åŠŸèƒ½å¢žå¼º**
- âœ… æ·»åŠ  `run_daily_update.py` ä¸»æŽ§è„šæœ¬
- âœ… é›†æˆæ—¥å¿—ç³»ç»Ÿï¼ˆlogs/ioc_collection.logï¼‰
- âœ… æ–°å¢ž `recent_high_risk_ips.csv` é«˜å±IPä¸“ç”¨æ–‡ä»¶
- âœ… ä¼˜åŒ–æ—¶é—´è¿‡æ»¤é€»è¾‘ï¼ˆ3ä¸ªæœˆæ•°æ®ä¿ç•™ï¼‰
- âœ… æ”¯æŒå®šæ—¶ä»»åŠ¡è‡ªåŠ¨åŒ–è¿è¡Œ

**æ•°æ®ç»Ÿè®¡**
- æ€»æ•°æ®æº: 16ä¸ªï¼ˆä¼˜è´¨8ä¸ª + ä¸€èˆ¬8ä¸ªï¼‰
- åŽ†å²è®°å½•: ~156,000æ¡
- æœ€è¿‘3ä¸ªæœˆ: ~128,000æ¡
- é«˜å±IP: ~12,000æ¡ï¼ˆcountâ‰¥3ï¼‰

